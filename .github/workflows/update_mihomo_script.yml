name: Update Mihomo Extension Script

on:
  push:
    paths:
      - 'Mihomo/Extension_Script/**'
      - 'Mihomo/auto_update_config/auto_update_js.py'
      - 'pyproject.toml'
      - 'pdm.lock'
      - '.github/workflows/update_mihomo_script.yml'
      - '.github/workflows/reusable-mihomo-update.yml'
  schedule:
    - cron: '0 13 * * *'
  workflow_dispatch:

permissions:
  contents: write

concurrency:
  group: mihomo-script-update
  cancel-in-progress: true

jobs:
  update_script:
    uses: ./.github/workflows/reusable-mihomo-update.yml
    with:
      script_name: 'auto_update_js.py'
      commit_message: |
        chore: update mihomo extension script

        - Updated fake-ip-filter, nameserver-policy, and hosts
        - Auto-generated by GitHub Actions
      target_path: 'Mihomo/Extension_Script/'
      timeout_minutes: 10
